# Workflow: Add Nostr Client Simulator
# Adds a new interactive simulator for a Nostr client

workflow:
  id: add-simulator
  name: Add Nostr Client Simulator
  description: >
    Creates a complete simulator for a Nostr client including:
    - Research and asset gathering
    - Page and component implementation
    - Tour creation
    - System integration
  version: 1.0.0

  inputs:
    - name: client_name
      type: string
      required: true
      description: Name of the Nostr client (e.g., "Damus", "Iris")
    
    - name: platform
      type: string
      required: true
      description: Platform type (ios, android, web, desktop)
      
    - name: client_slug
      type: string
      required: false
      description: URL-friendly slug (auto-generated from client_name if not provided)
    
    - name: description
      type: string
      required: false
      description: Short description (auto-researched if not provided)

  steps:
    - id: research_client
      name: Research Client
      agent: research-agent
      description: Gather information, branding, and assets for the client
      inputs:
        target_name: "{{workflow.inputs.client_name}}"
        target_type: "nostr_client"
        platform: "{{workflow.inputs.platform}}"
        existing_patterns: "src/simulators/"
      outputs:
        - report
        - branding_assets
        - feature_list
        - screenshots
      decision_gate: false

    - id: design_spec
      name: Create Design Specification
      agent: design-agent
      depends_on: [research_client]
      description: Create detailed UI/UX specification based on research
      inputs:
        research_report: "{{steps.research_client.outputs.report}}"
        platform: "{{workflow.inputs.platform}}"
        pattern_reference: "src/simulators/damus/"
      outputs:
        - design_spec
        - color_scheme
        - screen_specs
      decision_gate: true  # Human approval on design direction

    - id: implement_page
      name: Implement Simulator Page
      agent: code-agent
      depends_on: [design_spec]
      description: Create the Astro page for the simulator
      inputs:
        specification: "{{steps.design_spec.outputs.design_spec}}"
        target_location: "src/pages/simulators/{{workflow.inputs.client_slug}}.astro"
        pattern_reference: "src/pages/simulators/damus.astro"
        client_name: "{{workflow.inputs.client_name}}"
        platform: "{{workflow.inputs.platform}}"
      outputs:
        - page_file
        - navigation_updated
      decision_gate: false

    - id: implement_tour
      name: Create Interactive Tour
      agent: code-agent
      depends_on: [design_spec]
      description: Create the guided tour configuration
      inputs:
        specification: "{{steps.design_spec.outputs.screen_specs}}"
        target_location: "src/data/tours/{{workflow.inputs.client_slug}}-tour.ts"
        pattern_reference: "src/data/tours/damus-tour.ts"
        client_name: "{{workflow.inputs.client_name}}"
      outputs:
        - tour_file
        - tour_config
      decision_gate: false

    - id: implement_simulator
      name: Build Simulator Components
      agent: code-agent
      depends_on: [design_spec]
      description: Create React components for the simulator
      inputs:
        specification: "{{steps.design_spec.outputs.screen_specs}}"
        target_location: "src/simulators/{{workflow.inputs.client_slug}}/"
        pattern_reference: "src/simulators/damus/"
        client_name: "{{workflow.inputs.client_name}}"
        platform: "{{workflow.inputs.platform}}"
      outputs:
        - component_files
        - theme_file
        - types_file
      decision_gate: false

    - id: integrate_system
      name: Integrate into System
      agent: integration-agent
      depends_on: [implement_page, implement_tour, implement_simulator]
      description: Add simulator to configs, navigation, and exports
      inputs:
        component_to_integrate: "{{steps.implement_simulator.outputs}}"
        tour_file: "{{steps.implement_tour.outputs.tour_file}}"
        page_file: "{{steps.implement_page.outputs.page_file}}"
        client_name: "{{workflow.inputs.client_name}}"
        platform: "{{workflow.inputs.platform}}"
        integration_points:
          - "src/simulators/shared/configs.ts"
          - "src/data/tours/index.ts"
          - "src/pages/simulators/index.astro"
          - "src/simulators/index.ts"
      outputs:
        - configs_updated
        - navigation_updated
        - exports_updated
      decision_gate: false

    - id: quality_check
      name: Quality Assurance
      agent: qa-agent
      depends_on: [integrate_system]
      description: Review implementation for quality and completeness
      inputs:
        implementation: "{{steps.integrate_system.outputs}}"
        specification: "{{steps.research_client.outputs.report}}"
        pattern_reference: "src/simulators/damus/"
        checklist:
          - page_structure
          - navigation_dropdown
          - tour_complete
          - theme_colors
          - icon_exists
          - types_complete
      outputs:
        - qa_report
        - issues
        - approval_status
      decision_gate: true  # Human review of QA results

    - id: final_integration
      name: Final Integration
      agent: integration-agent
      depends_on: [quality_check]
      description: Apply any fixes and finalize integration
      inputs:
        qa_report: "{{steps.quality_check.outputs.qa_report}}"
        fixes_needed: "{{steps.quality_check.outputs.issues}}"
      outputs:
        - final_status
      decision_gate: false

  outputs:
    - name: simulator_page
      source: implement_page.page_file
      description: Path to the created simulator page
    
    - name: tour_config
      source: implement_tour.tour_config
      description: Tour configuration object
    
    - name: components_dir
      source: implement_simulator.component_files
      description: Directory containing simulator components
    
    - name: qa_status
      source: quality_check.approval_status
      description: Final QA approval status
