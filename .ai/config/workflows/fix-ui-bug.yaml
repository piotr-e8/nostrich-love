# Workflow: Fix UI Bug
# Systematic debugging and fixing of UI issues

workflow:
  id: fix-ui-bug
  name: Fix UI Bug
  description: >
    Systematically diagnose and fix UI bugs with specialized agents.
    Handles both quick visual glitches and complex layout issues.
    Includes verification and regression checking.
  version: 1.0.0

  inputs:
    - name: bug_description
      type: string
      required: true
      description: Description of the visual issue (what's wrong vs expected)
    
    - name: screenshot_path
      type: string
      required: false
      description: Path to screenshot showing the bug (recommended for UI issues)
    
    - name: location_hint
      type: string
      required: false
      description: URL path, component name, or file where bug occurs
    
    - name: reproduction_steps
      type: string
      required: false
      description: Steps to reproduce the bug
    
    - name: severity
      type: string
      required: false
      default: medium
      description: Severity level (critical, high, medium, low)
    
    - name: device_context
      type: string
      required: false
      description: Browser, device, or viewport where bug occurs

  steps:
    - id: parse_bug_report
      name: Parse Bug Report
      agent: ui-parser-agent
      description: Extract structured information from bug description
      inputs:
        bug_description: "{{workflow.inputs.bug_description}}"
        screenshot_path: "{{workflow.inputs.screenshot_path}}"
        location_hint: "{{workflow.inputs.location_hint}}"
        reproduction_steps: "{{workflow.inputs.reproduction_steps}}"
        device_context: "{{workflow.inputs.device_context}}"
      outputs:
        - issue_type
        - affected_elements
        - visual_symptoms
        - context_clues
      decision_gate: false

    - id: triage_issue
      name: Triage Issue Complexity
      agent: triage-agent
      depends_on: [parse_bug_report]
      description: Determine if quick fix or deep investigation needed
      inputs:
        issue_type: "{{steps.parse_bug_report.outputs.issue_type}}"
        severity: "{{workflow.inputs.severity}}"
        visual_symptoms: "{{steps.parse_bug_report.outputs.visual_symptoms}}"
      outputs:
        - complexity_level
        - triage_decision
        - skip_steps
      decision_gate: false

    - id: gather_component_context
      name: Locate Affected Components
      agent: component-detective-agent
      depends_on: [parse_bug_report, triage_issue]
      description: Find exact component files, props, and usage patterns
      inputs:
        location_hint: "{{workflow.inputs.location_hint}}"
        affected_elements: "{{steps.parse_bug_report.outputs.affected_elements}}"
        issue_type: "{{steps.parse_bug_report.outputs.issue_type}}"
      outputs:
        - component_files
        - parent_tree
        - prop_interfaces
        - import_dependencies
      decision_gate: false

    - id: audit_styling
      name: Audit CSS and Styles
      agent: css-conflict-hunter-agent
      depends_on: [gather_component_context, triage_issue]
      description: Identify style conflicts, overrides, and responsive issues
      inputs:
        component_files: "{{steps.gather_component_context.outputs.component_files}}"
        visual_symptoms: "{{steps.parse_bug_report.outputs.visual_symptoms}}"
        device_context: "{{workflow.inputs.device_context}}"
      outputs:
        - style_sources
        - conflicting_rules
        - responsive_issues
        - theme_variables
        - css_modules
      decision_gate: false

    - id: find_similar_patterns
      name: Find Working Patterns
      agent: pattern-matcher-agent
      depends_on: [gather_component_context, audit_styling]
      description: Look for similar working UI elsewhere in codebase
      inputs:
        component_type: "{{steps.gather_component_context.outputs.component_files}}"
        visual_symptoms: "{{steps.parse_bug_report.outputs.visual_symptoms}}"
        issue_type: "{{steps.parse_bug_report.outputs.issue_type}}"
      outputs:
        - reference_implementations
        - working_patterns
        - design_system_links
      decision_gate: false

    - id: root_cause_analysis
      name: Analyze Root Cause
      agent: root-cause-agent
      depends_on: [gather_component_context, audit_styling, find_similar_patterns]
      skip_if: "{{steps.triage_issue.outputs.complexity_level == 'quick'}}"
      description: Determine why the bug is happening (not just symptoms)
      inputs:
        component_context: "{{steps.gather_component_context.outputs}}"
        styling_audit: "{{steps.audit_styling.outputs}}"
        similar_patterns: "{{steps.find_similar_patterns.outputs}}"
        visual_symptoms: "{{steps.parse_bug_report.outputs.visual_symptoms}}"
      outputs:
        - root_cause
        - contributing_factors
        - fix_approach
        - risk_assessment
      decision_gate: true  # Human approval on root cause before fixing

    - id: implement_fix
      name: Implement Fix
      agent: ui-fix-implementer-agent
      depends_on: [root_cause_analysis]
      description: Apply the fix following codebase patterns
      inputs:
        fix_approach: "{{steps.root_cause_analysis.outputs.fix_approach}}"
        component_files: "{{steps.gather_component_context.outputs.component_files}}"
        reference_patterns: "{{steps.find_similar_patterns.outputs.working_patterns}}"
        styling_audit: "{{steps.audit_styling.outputs}}"
        issue_type: "{{steps.parse_bug_report.outputs.issue_type}}"
      outputs:
        - modified_files
        - fix_summary
        - tests_added
      decision_gate: false

    - id: verify_fix
      name: Verify Fix
      agent: ui-verify-agent
      depends_on: [implement_fix]
      description: Test fix works and check for visual regressions
      inputs:
        modified_files: "{{steps.implement_fix.outputs.modified_files}}"
        original_bug: "{{workflow.inputs.bug_description}}"
        reproduction_steps: "{{workflow.inputs.reproduction_steps}}"
        device_context: "{{workflow.inputs.device_context}}"
        component_tree: "{{steps.gather_component_context.outputs.parent_tree}}"
      outputs:
        - fix_verified
        - visual_regression_check
        - related_issues_found
        - test_results
      decision_gate: true  # Human review that fix actually works

    - id: regression_check
      name: Check for Regressions
      agent: regression-checker-agent
      depends_on: [verify_fix]
      description: Ensure fix doesn't break other UI elements
      inputs:
        modified_files: "{{steps.implement_fix.outputs.modified_files}}"
        component_tree: "{{steps.gather_component_context.outputs.parent_tree}}"
        import_dependencies: "{{steps.gather_component_context.outputs.import_dependencies}}"
      outputs:
        - regression_report
        - affected_screens
        - cross_browser_check
      decision_gate: false

    - id: document_fix
      name: Document Solution
      agent: doc-agent
      depends_on: [verify_fix, regression_check]
      description: Update docs if this reveals pattern issues
      inputs:
        root_cause: "{{steps.root_cause_analysis.outputs.root_cause}}"
        fix_summary: "{{steps.implement_fix.outputs.fix_summary}}"
        pattern_insights: "{{steps.find_similar_patterns.outputs}}"
      outputs:
        - docs_updated
        - lessons_learned
      decision_gate: false

  outputs:
    - name: fix_status
      source: verify_fix.fix_verified
      description: Whether the fix was verified to work
    
    - name: modified_files
      source: implement_fix.modified_files
      description: List of files that were modified
    
    - name: root_cause
      source: root_cause_analysis.root_cause
      description: Root cause analysis of the bug
    
    - name: regression_report
      source: regression_check.regression_report
      description: Any regressions introduced by the fix
    
    - name: fix_summary
      source: implement_fix.fix_summary
      description: Summary of changes made
    
    - name: related_issues
      source: verify_fix.related_issues_found
      description: Related UI issues discovered during fix

  usage_examples:
    - description: Quick CSS fix
      command: |
        "Fix UI bug: Button text is misaligned on mobile. 
         Location: /follow-pack page, FollowButton component. 
         Screenshot: /bugs/button-alignment.png"
    
    - description: Complex layout issue
      command: |
        "Run workflow fix-ui-bug with:
          bug_description='Grid layout breaks on tablets, cards overlap'
          location_hint='src/components/community/CreatorGrid.tsx'
          device_context='iPad, Safari, 768px width'
          severity='high'"
    
    - description: Visual glitch
      command: |
        "Fix this: Modal backdrop has wrong opacity, should be 50% but showing 100%.
         Happens on all community pages."
